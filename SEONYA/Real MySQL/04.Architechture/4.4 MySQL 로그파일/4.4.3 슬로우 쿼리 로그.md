MySQL 서버의 쿼리 튜닝은 크게 서비스가 적용되기 전 전체적으로 튜닝하는 경우와 서비스 운영중 MySQL 서버의 전체적인 성능 저하를 검사하거나 정기적인 점검을 위한 튜닝으로 나눌 수 있다.

후자의 경우 어떤 쿼리가 문제의 쿼리인지 판단하기가 상당히 어렵다.
이런 경우 서비스에서 사용되는 쿼리 중에서 어떤 쿼리가 문제인지를 판단하는 데 슬로우 쿼리 로그가 상당히 많은 도움이 된다.

슬로우 쿼리 로그 파일에는 long_quert_time 시스템 변수에 설정한 시간(long_query_time 파라미터는 초 단위로 설정하지만 소수점 값으로 설정하면 마이크로 초 단위로 설정 가능)이상의 시간이 소요된 쿼리가 모두 기록이 된다.

슬로우 쿼리 로그는 MySQL이 쿼리를 실행 한 후, 실제 소요된 시간을 기준으로 슬로우 쿼리 로그에 기록할지 여부를 판단하기 때문에 반드시 쿼리가 정상적으로 실행이 완료해야 슬로우 쿼리 로그에 기록이 될 수 있다.

```ad-tip
title:결국은 CVS파일
log_output 옵션을 TABLE로 설정하더라도 mysql DB의 slow_log 테이블과 general_log 테이블은 CSV 스토리 엔진을 사용하기 때문에 결국 CSV 파일로 저장하는 것 과 동일하게 작동한다.
```

### 슬로우 쿼리로그 출력 예시
```mysql
#Time: ~ 쿼리 종료 시간, 쿼리가 언제 시작됬는지 확이하려면 Query_time만큼 빼야함
#User@Host: ~ 사용자
#Query_time: ~ 걸린 시간
```


일반적으로 슬로우 쿼리 또는 제너럴 로그 파일의 내용이 상당히 많아서 직접 쿼리를 하나씩 검토하기에 시간이 너무 많이 걸리거나 어느 쿼리를 집중적으로 튜닝해야 할지 식별하기 어려울 수도 있다.

이런 경우 Percona에서 개발한 Percona Toolkit의 pt-query-digest 스크립트를 이용하면 쉽게 빈도나 처리 성능별로 쿼리를 정렬해서 살펴볼 수 있다.

```javascript
linux > pt-query-digest --type='genlog' general.log > persed_general.log

## Slow Log 파일 분석
linux > pt-query-digest --type='slowlog' mysql-slow.log > parsed_mysql-slog.log
```

로그 파일의 분석이 완료되면 그 결과는 다음과 같이 3개의 그룹으로 나뉘어 저장된다.

### 4.4.3.1 슬로우 쿼리 통계
모든 쿼리 대상으로 슬로우 쿼리 로그 실행시간 그리고 잠금 대기 시간 등에 대해 평균 및 최소/최대 값을 보여준다.

### 4.4.3.2 실행 빈도 및 누적실행 시간순 랭킹
각 쿼리별로 응답 시간과 실행 횟수를 보여준다.
pt-query-digest 명령 실행시 --order--by 옵션으로 정렬 순서를 변경할 수 있다.

### 4.4.3.3 쿼리별 실행 횟수 및 누적 실행 시간 상세 정보
Query ID별 쿼리를 쿼리 랭킹에 표시된 순서대로 자세한 내용을 보여준다.

