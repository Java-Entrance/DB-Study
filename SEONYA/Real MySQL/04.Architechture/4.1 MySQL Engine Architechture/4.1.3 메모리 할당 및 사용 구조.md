
MySQL 메모리공간
- 로컬 메모리 영역
- 글로벌 메모리 영역

 ![이미지 대체 텍스트](../../../attachment/Pasted%20image%2020231212232205.png)

MySQL에서 사용되는 메모리 공간은 크게 글로벌 메모리 영역과 로컬 메모리 영역으로 구분할 수 있다. 

### 글로벌 메모리 영역

글로벌 메모리 영역의 모든 메모리 공간은 **MySQL 서버가 시작되면서 운영체제로부터 할당**된다. 운영체제의 종류에 따라 다르겠지만 요청된 메모리 공간을 100% 할당해줄 수도 있고, 그 공간만큼 예약해두고 필요할 때 조금씩 할당해주는 경우도 있다. 
각 운영체제의 메모리 할당 방식은 상당히 복잡하며, MySQL 서버가 사용하는 정확한 메모리의 양을 측정하는 것 또한 쉽지 않다. 

*그냥 단순하게 MySQL의 시스템 변수로 설정해 둔 만큼 운영체제로부터 메모리를 할당받는다고 생각해도 된다.*

글로벌 메모리 영역과 로컬 메모리 영역은 MySQL 서버 내에 존재하는 많은 스레드가 공유해서 사용하는 공간인지 여부에 따라 구분되며 각각 다음과 같은 특성이 있다.

## 4.1.3.1 글로벌 메모리 영역

일반적으로 클라이언트 스레드의 수와 무난하게 **하나의 메모리 공간만 할당**된다. 단, 필요에 따라 2개 이상의 메모리 공간을 할당받을 수도 있지만 클라이언트의 스레드 수와는 무관하며, 생성된 글로벌 영역이 N개라 하더라도 모든 스레드에 의해 공유된다. 대표적인 글로벌 메모리 영역은 다음과 같다.

- 테이블 캐시
- InnoDB 버퍼 풀
- InnoDB 어댑티브 해시 인덱스
- InnoDB 리두 로그 버퍼

## 4.1.3.2 로컬 메모리 영역

세션 메모리 영역이라도고 표현하며, MySQL 서버상에 존재하는 클라이언트 스레드가 **쿼리를 처리하는 데 사용하는 메모리 영역**이다. 대표적으로 그림 4.3의 커넥션 버퍼와 정렬(소트) 버퍼 등이 있다. 그림 4.2에서 볼 수 있듯 클라이언트가 MySQL 서버에 접속하면 MySQL 서버에서는 클라이언트 커넥션으로부터 요청을 처리하기 위해 스레드를 하나씩 할당하게 되는데, 클라이언트 스레드가 사용하는 메모리 공간이라고 해서 클라이언트 메모리 영역이라고도 한다. **클라이언트와 MySQL 서버와 커넥션을 세션이라고 하기 때문에 로컬 메모리 영역을 세션 메모리 영역이라고도 표현**한다. 

로컬 메모리는 각 클라이언트 스레드별로 독립적으로 할당되며 절대 공유되어 사용되지 않는다는 특징이 있다. 일반적으로 글로벌 메모리 영역의 크기는 주의해서 설정하지만 소트 버퍼와 같은 로컬 메모리 영역은 크게 신경 쓰지 않고 설정하는데, 최악의 경우(가능성은 희박하지만)에는 MySQL 서버가 메모리 부족으로 멈춰 버릴 수도 있으므로 적절한 메모리 공간을 설정하는 것이 중요하다. 로컬 메모리 공간의 또 한 가지 중요한 특징은 각 쿼리의 용도별로 필요할 때만 공간이 할당되고 필요하지 않은 경우에는 MySQL이 메모리 공간을 할당조차도 하지 않을 수도 있다는 점이다. 대표적으로 소트 버퍼나 조인 버퍼와 같은 공간이 그러하다. 그리고 로컬 메모리 공간은 커넥션이 열려있는 동안 계속 할당된 상태로 남아 있는 공간도 있고(커넥션 버퍼나 결과 버퍼) 그렇지 않고 쿼리를 실행하는 순간에만 할당했다가 다시 해제하는 공간(소트 버퍼나 조인 버퍼)도 있다.

대표적인 로컬 메모리 영역은 다음과 같다.
- 정렬 버퍼(Sort Buffer)
- 조인 버퍼
- 바이너리 로그 캐시
- 네트워크 버퍼

#### 요약
- MySQL 메모리 공간은 다음의 두개로 나뉘어진다
- 글로벌 메모리 영역
	- 설정된 MySQL 시스템 변수만큼 운영체제로 부터 메모리가 할당된다.
	- 클라이언트,스레드 수와 무관하게 하나의 메모리만 할당 받는다.
	- 필요에 따라 2개 이상의 메모리도 할당 받을 수 있다. 클라이언트와 스레드 수와 무관하다.
	- 생성된 글로벌 영역이 N개라 하더라도 모든 스레드에 의해 공유된다.
		- 글로벌 메모리 영역은 다음과 같다.
			-  테이블 캐시
			- InnoDB 버퍼 풀
			- InnoDB 어댑티브 해시 인덱스
			- InnoDB 리두 로그 버퍼
- 로컬 메모리 영역(세션 메모리 영역,클라이언트 메모리 영역)
	- MySQL 서버상에 존재하는 **클라이언트 스레드가** **쿼리를 처리하는데 사용**
	- 클라이언트가 MySQL서버에 접속하면 클라이언트는 서버로 부터 스레드가 할당된다. 그래서 **클라이언트 메모리 영역**이라고도 함.
	- MySQL 서버와 커넥션 세션이라 하기때문에 **세션 메모리 영역**이라고도 불림
	- 클라이언트 스레드별로 독립적으로 할당, 절대 공유안되는 특징을 가짐
	- 소트 버퍼와 같은 로컬 메모리 영역은 메모리 영역크기 신경 안씀
		- 최악의경우 메모리 부족 발생의 원인이 될 수 있음
		- 적절하게 설정하는게 중요
	- 로컬 메모리 공간이 중요한 또 한가지 특징은 쿼리의 용도별로 메모리 할당되거나 되지 않는다. (소트버퍼, 조인버퍼)
	- 커넥션이 열려있는 동안 계속 할당된 상태로 남아있는 공간
		- 커넥션 버퍼, 결과 버퍼
	- 쿼리를 실행할때만 할당되는 공간
		- 소트 버퍼나 조인 버퍼
	- 대표적인 로컬 메모리 영역은 다음과 같다
		- 정렬 버퍼(Sort Buffer)
		- 조인 버퍼
		- 바이너리 로그 캐시
		- 네트워크 버퍼
